# Ingress Controller for FastFood Delivery
# Using NGINX Ingress Controller
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: fastfood-ingress
  namespace: fastfood
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    # Rate limiting
    nginx.ingress.kubernetes.io/limit-rps: "100"
    nginx.ingress.kubernetes.io/limit-connections: "50"
spec:
  ingressClassName: nginx
  rules:
    # API Gateway routing
    - host: api.fastfood.local
      http:
        paths:
          # Auth Service
          - path: /auth
            pathType: Prefix
            backend:
              service:
                name: auth-service
                port:
                  number: 5001
          - path: /users
            pathType: Prefix
            backend:
              service:
                name: auth-service
                port:
                  number: 5001
                  
          # Order Service
          - path: /orders
            pathType: Prefix
            backend:
              service:
                name: order-service
                port:
                  number: 5002
          - path: /cart
            pathType: Prefix
            backend:
              service:
                name: order-service
                port:
                  number: 5002
                  
          # Restaurant Service
          - path: /restaurants
            pathType: Prefix
            backend:
              service:
                name: restaurant-service
                port:
                  number: 5003
          - path: /menu
            pathType: Prefix
            backend:
              service:
                name: restaurant-service
                port:
                  number: 5003
                  
          # Payment Service
          - path: /payments
            pathType: Prefix
            backend:
              service:
                name: payment-service
                port:
                  number: 5005
                  
          # Notification Service
          - path: /notifications
            pathType: Prefix
            backend:
              service:
                name: notification-service
                port:
                  number: 5006

---
# TLS Certificate (for production, use cert-manager)
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: fastfood-ingress-tls
#   namespace: fastfood
#   annotations:
#     cert-manager.io/cluster-issuer: letsencrypt-prod
# spec:
#   tls:
#     - hosts:
#         - api.fastfood.com
#       secretName: fastfood-tls-secret
